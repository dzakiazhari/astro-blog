---
import Link from '@/components/Link.astro'
import { ICON_MAP, NAV_LINKS, SITE, SOCIAL_LINKS } from '@/consts'
import { cn } from '@/lib/utils'
import { Icon } from 'astro-icon/components'

const navLinks = NAV_LINKS
const socials = SOCIAL_LINKS
const currentYear = new Date().getFullYear()
const { pathname } = Astro.url
const normalizedPath =
  pathname === '/' ? pathname : pathname.replace(/\/+$/, '')
const isAboutPage = normalizedPath === '/about'
const filteredNavLinks = navLinks.filter((link) => link.href !== '/about')
const showConnect = !isAboutPage && socials.length > 0
const gridTemplate = showConnect
  ? 'md:grid-cols-[1.25fr_1fr_1fr]'
  : 'md:grid-cols-[1.5fr_1fr]'
---

<footer
  class="border-accent/40 bg-muted/40 text-foreground/80 border-t text-sm"
>
  <div class="mx-auto flex w-full max-w-5xl flex-col gap-10 px-4 py-10">
    <div class={cn('grid gap-8', gridTemplate)}>
      <div class="flex flex-col gap-4">
        <div class="flex flex-col gap-1">
          <span
            class="text-muted-foreground text-xs font-semibold tracking-[0.28em] uppercase"
          >
            {SITE.title}
          </span>
        </div>
      </div>

      <div class="flex flex-col gap-3">
        <span
          class="text-muted-foreground text-xs font-semibold tracking-[0.28em] uppercase"
        >
          Explore
        </span>
        <ul class="flex flex-col gap-2" role="list">
          {
            filteredNavLinks.map((link) => {
              const isExternal = link.href.startsWith('http')
              return (
                <li>
                  <Link
                    href={link.href}
                    class="text-foreground/70 hover:text-foreground inline-flex items-center gap-2 transition-colors"
                    external={isExternal}
                  >
                    <span
                      class="bg-secondary/60 h-1.5 w-1.5 rounded-full"
                      aria-hidden="true"
                    />
                    <span class="capitalize">{link.label}</span>
                    {isExternal && (
                      <Icon
                        name="lucide:arrow-up-right"
                        class="text-muted-foreground size-3"
                      />
                    )}
                  </Link>
                </li>
              )
            })
          }
        </ul>
      </div>

      {
        showConnect && (
          <div class="flex flex-col gap-3">
            <span class="text-muted-foreground text-xs font-semibold tracking-[0.28em] uppercase">
              Connect
            </span>
            <ul class="flex flex-col gap-2" role="list">
              {socials.map((item) => {
                const isExternal = /^https?:/i.test(item.href)
                return (
                  <li>
                    <Link
                      href={item.href}
                      external={isExternal}
                      class="text-foreground/70 hover:text-foreground inline-flex items-center gap-2 transition-colors"
                    >
                      <Icon
                        name={
                          ICON_MAP[item.label as keyof typeof ICON_MAP] ||
                          'lucide:message-circle-question'
                        }
                        class="text-muted-foreground size-4"
                      />
                      <span>{item.label}</span>
                      {isExternal && (
                        <Icon
                          name="lucide:arrow-up-right"
                          class="text-muted-foreground size-3"
                        />
                      )}
                    </Link>
                  </li>
                )
              })}
            </ul>
          </div>
        )
      }
    </div>

    <div
      class="border-border/60 text-muted-foreground flex flex-col gap-2 border-t pt-6 text-xs tracking-[0.22em] uppercase sm:flex-row sm:items-center sm:justify-between"
    >
      <span>&copy; {currentYear} {SITE.title}. All rights reserved.</span>
      <span>
        Crafted with care by <Link
          href="https://dzakiazhari.com"
          class="text-secondary hover:text-foreground"
          external
          underline>Dzaki&nbsp;Azhari</Link
        >
        .
      </span>
    </div>
  </div>
</footer>
