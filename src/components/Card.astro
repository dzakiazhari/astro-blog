---
import { slugifyStr } from "@/utils/slugify";
import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";

export interface Props extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3";
  showDescription?: boolean;
}

const {
  variant = "h2",
  data,
  id,
  filePath,
  showDescription = true,
} = Astro.props as Props;

const { title, description, pubDatetime } = data;

const toIsoDots = (value: string | number | Date) => {
  const date = new Date(value);

  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0");
  const day = String(date.getDate()).padStart(2, "0");

  return `${year}.${month}.${day}`;
};

const formattedDate = toIsoDots(pubDatetime);

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
};
---

<li class="my-0 h-full">
  <a
    href={getPath(id, filePath)}
    class="group relative flex h-full flex-col justify-between gap-6 overflow-hidden rounded-[var(--radius-md)] border border-[var(--border-soft)] bg-[var(--surface-subtle)] px-6 py-7 transition-colors duration-200 ease-out hover:border-[color:var(--border-strong)] focus-visible:ring-2 focus-visible:ring-[color:var(--ring-accent)] focus-visible:outline-none"
    data-astro-prefetch="viewport"
  >
    <span
      aria-hidden="true"
      class="pointer-events-none absolute top-6 bottom-6 left-0 w-3 -translate-x-[0.68rem] bg-[color:var(--card-marker)] transition-colors duration-200 ease-out [clip-path:polygon(0%_0,100%_50%,0%_100%)] group-hover:bg-[color:var(--card-marker-hover)] group-focus-visible:bg-[color:var(--card-marker-hover)]"
    ></span>

    <div class="space-y-4 ps-4">
      <p
        class="text-[0.68rem] font-semibold tracking-[0.28em] text-[color:var(--muted-text)] uppercase"
      >
        {formattedDate}
      </p>
      {
        variant === "h2" ? (
          <h2
            {...headerProps}
            class="text-xl font-semibold text-balance text-[color:var(--body-text)] transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)] sm:text-[1.55rem]"
          >
            {title}
          </h2>
        ) : (
          <h3
            {...headerProps}
            class="text-lg font-semibold text-balance text-[color:var(--body-text)] transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
          >
            {title}
          </h3>
        )
      }
      {
        showDescription && (
          <p
            class="text-sm leading-relaxed text-[color:var(--muted-text)] sm:text-base"
            style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;"
          >
            {description}
          </p>
        )
      }
    </div>

    <span
      class="mt-auto inline-flex items-center gap-2 ps-4 text-[0.68rem] font-semibold tracking-[0.26em] text-[color:var(--nav-text)] uppercase transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
    >
      Read
      <IconArrowRight class="size-3 rtl:rotate-180" />
    </span>
  </a>
</li>
