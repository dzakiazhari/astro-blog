---
import { slugifyStr } from "@/utils/slugify";
import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import IconNoteCard from "@/assets/icons/IconNoteCard.svg";

export interface Props extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3";
  showDescription?: boolean;
}

const {
  variant = "h2",
  data,
  id,
  filePath,
  showDescription = true,
} = Astro.props as Props;

const { title, description, pubDatetime } = data;

const toIsoDots = (value: string | number | Date) => {
  const date = new Date(value);

  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0");
  const day = String(date.getDate()).padStart(2, "0");

  return `${year}.${month}.${day}`;
};

const formattedDate = toIsoDots(pubDatetime);

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
};
---

<li class="my-0 h-full">
  <a
    href={getPath(id, filePath)}
    class="group relative flex h-full flex-col justify-between gap-[var(--card-content-gap)] overflow-hidden rounded-[var(--radius-md)] border border-[color:var(--card-border)] bg-[color:var(--surface-raised)] px-[var(--card-padding-inline)] py-[var(--card-padding-block)] transition-colors duration-200 ease-out hover:border-[color:var(--card-border-strong)] focus-visible:ring-2 focus-visible:ring-[color:var(--ring-accent)] focus-visible:outline-none"
    data-card-variant={variant}
    data-astro-prefetch="viewport"
  >
    <!-- Marker sizing comes from --card-marker-width/--card-marker-offset in src/styles/global.css -->
    <span
      aria-hidden="true"
      class="pointer-events-none absolute inset-y-3.5 left-0 w-[var(--card-marker-width)] -translate-x-[var(--card-marker-offset)] bg-[color:var(--card-marker)] transition-colors duration-200 ease-out [clip-path:polygon(0%_0,100%_50%,0%_100%)] group-hover:bg-[color:var(--card-marker-hover)] group-focus-visible:bg-[color:var(--card-marker-hover)]"
    ></span>

    <div class="relative z-[1] flex flex-col gap-3 ps-3">
      <div class="flex items-center gap-2">
        <span aria-hidden="true" class="card-icon">
          <IconNoteCard class="size-[0.9rem]" />
        </span>
        <p
          class="font-semibold tracking-[var(--card-meta-tracking)] text-[color:var(--muted-text)] text-[var(--card-meta-size)] uppercase"
        >
          {formattedDate}
        </p>
      </div>
      {
        variant === "h2" ? (
          <h2
            {...headerProps}
            class="leading-tight font-semibold text-balance text-[color:var(--body-text)] text-[var(--card-heading-h2)] transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)] sm:text-[1.36rem]"
          >
            {title}
          </h2>
        ) : (
          <h3
            {...headerProps}
            class="leading-snug font-semibold text-balance text-[color:var(--body-text)] text-[var(--card-heading-h3)] transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
          >
            {title}
          </h3>
        )
      }
      {
        showDescription && (
          <p
            class="text-[color:var(--muted-text)] text-[var(--card-body-size)]"
            style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: var(--card-body-leading);"
          >
            {description}
          </p>
        )
      }
    </div>

    <span
      class="mt-auto inline-flex items-center gap-1 ps-3 font-semibold tracking-[var(--card-footer-tracking)] text-[color:var(--nav-text)] text-[var(--card-footer-size)] uppercase transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
    >
      Read
      <IconArrowRight
        class="size-[0.95rem] transition-transform duration-200 ease-out group-hover:translate-x-[0.25rem] group-focus-visible:translate-x-[0.25rem] rtl:rotate-180"
      />
    </span>
  </a>
</li>
