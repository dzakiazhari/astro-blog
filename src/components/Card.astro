---
import { slugifyStr } from "@/utils/slugify";
import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";

export interface Props extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3";
  showDescription?: boolean;
}

const {
  variant = "h2",
  data,
  id,
  filePath,
  showDescription = true,
} = Astro.props as Props;

const { title, description, pubDatetime } = data;

const formattedDate = new Intl.DateTimeFormat(undefined, {
  day: "2-digit",
  month: "short",
  year: "numeric",
}).format(new Date(pubDatetime));

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
};
---

<li class="my-0 h-full">
  <a
    href={getPath(id, filePath)}
    class="group flex h-full flex-col justify-between gap-6 rounded-2xl border border-border/70 bg-background/80 p-5 shadow-sm ring-1 ring-border/40 transition-all duration-200 ease-out hover:-translate-y-1 hover:border-accent/40 hover:shadow-xl focus-visible:ring-2 focus-visible:ring-accent/40 focus-visible:outline-none sm:p-6"
  >
    <div class="space-y-3">
      <div class="flex items-start justify-between gap-4">
        {
          variant === "h2" ? (
            <h2
              {...headerProps}
              class="text-xl font-semibold text-balance text-foreground transition-colors group-hover:text-accent group-focus-visible:text-accent sm:text-2xl"
            >
              {title}
            </h2>
          ) : (
            <h3
              {...headerProps}
              class="text-lg font-semibold text-balance text-foreground transition-colors group-hover:text-accent group-focus-visible:text-accent"
            >
              {title}
            </h3>
          )
        }
        <span
          class="hidden rounded-full border border-accent/30 bg-accent/10 px-3 py-1 text-[0.55rem] font-semibold tracking-[0.32em] text-accent/80 uppercase sm:inline-flex"
        >
          Post
        </span>
      </div>
      <p class="text-xs tracking-[0.28em] text-foreground/50 uppercase">
        {formattedDate}
      </p>
      {
        showDescription && (
          <p
            class="mt-1.5 text-sm leading-relaxed text-foreground/80 sm:text-base"
            style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;"
          >
            {description}
          </p>
        )
      }
    </div>

    <span
      class="mt-auto inline-flex items-center gap-2 text-xs font-semibold tracking-[0.32em] text-accent/80 uppercase transition group-hover:text-accent group-focus-visible:text-accent"
    >
      Read
      <IconArrowRight class="size-3 rtl:rotate-180" />
    </span>
  </a>
</li>
