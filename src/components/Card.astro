---
import { slugifyStr } from "@/utils/slugify";
import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";

export interface Props extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3";
  showDescription?: boolean;
}

const {
  variant = "h2",
  data,
  id,
  filePath,
  showDescription = true,
} = Astro.props as Props;

const { title, description, pubDatetime } = data;

const formattedDate = new Intl.DateTimeFormat(undefined, {
  day: "2-digit",
  month: "short",
  year: "numeric",
}).format(new Date(pubDatetime));

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
};
---

<li class="my-0 h-full">
  <a
    href={getPath(id, filePath)}
    class="group relative flex h-full flex-col justify-between gap-6 rounded-lg border border-border/60 bg-background/80 px-6 py-7 shadow-[0_18px_50px_rgba(24,20,45,0.12)] transition-all duration-200 ease-out before:absolute before:inset-y-4 before:left-0 before:w-[3px] before:rounded-full before:bg-gradient-to-b before:from-accent before:to-transparent before:opacity-60 before:transition-opacity hover:-translate-y-1 hover:border-accent/40 hover:shadow-[0_30px_70px_rgba(24,20,45,0.2)] hover:before:opacity-100 focus-visible:ring-2 focus-visible:ring-accent/35 focus-visible:outline-none"
    data-astro-prefetch="viewport"
  >
    <div class="space-y-4 ps-2">
      <p
        class="text-[0.68rem] font-semibold tracking-[0.32em] text-foreground/50 uppercase"
      >
        {formattedDate}
      </p>
      {
        variant === "h2" ? (
          <h2
            {...headerProps}
            class="text-xl font-semibold text-balance text-foreground transition-colors duration-150 group-hover:text-accent group-focus-visible:text-accent sm:text-[1.6rem]"
          >
            {title}
          </h2>
        ) : (
          <h3
            {...headerProps}
            class="text-lg font-semibold text-balance text-foreground transition-colors duration-150 group-hover:text-accent group-focus-visible:text-accent"
          >
            {title}
          </h3>
        )
      }
      {
        showDescription && (
          <p
            class="text-sm leading-relaxed text-foreground/75 sm:text-base"
            style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;"
          >
            {description}
          </p>
        )
      }
    </div>

    <span
      class="mt-auto inline-flex items-center gap-2 ps-2 text-[0.68rem] font-semibold tracking-[0.32em] text-accent/80 uppercase transition-colors duration-150 group-hover:text-accent group-focus-visible:text-accent"
    >
      Read
      <IconArrowRight class="size-3 rtl:rotate-180" />
    </span>
  </a>
</li>
