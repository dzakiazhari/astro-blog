---
import { slugifyStr } from "@/utils/slugify";
import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import IconNoteCard from "@/assets/icons/IconNoteCard.svg";

export interface Props extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3" | "bar";
  showDescription?: boolean;
}

const {
  variant = "h2",
  data,
  id,
  filePath,
  showDescription = true,
} = Astro.props as Props;

const { title, description, pubDatetime } = data;

const toIsoDots = (value: string | number | Date) => {
  const date = new Date(value);

  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0");
  const day = String(date.getDate()).padStart(2, "0");

  return `${year}.${month}.${day}`;
};

const formattedDate = toIsoDots(pubDatetime);
const isoDate = new Date(pubDatetime).toISOString();

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
};
---

{
  variant === "bar" && (
    <li class="my-0">
      <a
        href={getPath(id, filePath)}
        class="group relative flex w-full flex-col gap-4 overflow-hidden rounded-[var(--radius-sm)] border border-[color:var(--card-border)] bg-[color:var(--surface-subtle)] px-4 pt-5 pb-4 transition-colors duration-200 ease-out hover:border-[color:var(--card-border-strong)] hover:bg-[color:var(--surface-raised)] focus-visible:ring-2 focus-visible:ring-[color:var(--ring-accent)] focus-visible:outline-none sm:flex-row sm:items-start sm:justify-between sm:gap-6 sm:px-5 sm:pt-6 sm:pb-5"
        data-card-variant={variant}
        data-astro-prefetch="viewport"
      >
        <span
          aria-hidden="true"
          class="card-marker pointer-events-none absolute left-0 w-[var(--card-marker-width)] opacity-80 transition-opacity duration-200 group-hover:opacity-100 group-focus-visible:opacity-100"
        >
          <span aria-hidden="true" class="card-marker__scoop" />
        </span>

        <div class="flex flex-col gap-2 ps-[var(--card-marker-gutter)] text-start text-[color:var(--body-text)] sm:flex-1">
          <time
            datetime={isoDate}
            class="type-overline font-semibold text-[color:var(--muted-text)] uppercase transition-colors duration-150 group-hover:text-[color:var(--nav-text)] group-focus-visible:text-[color:var(--nav-text)] sm:hidden"
          >
            {formattedDate}
          </time>
          <h3
            {...headerProps}
            class="type-heading-sm font-semibold text-balance transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
          >
            {title}
          </h3>
          {showDescription && (
            <p class="type-body-small text-[color:var(--muted-text)]">
              {description}
            </p>
          )}
        </div>

        <time
          datetime={isoDate}
          class="type-overline-tight hidden shrink-0 self-start rounded-[var(--radius-sm)] border bg-[color:var(--accent)]/16 px-3 py-1 font-semibold text-[color:var(--heading-accent)] uppercase transition-colors duration-150 sm:block"
          style="border-color: color-mix(in srgb, var(--accent) 38%, transparent); margin-inline-start: var(--card-marker-gutter);"
        >
          {formattedDate}
        </time>
      </a>
    </li>
  )
}
{
  variant !== "bar" && (
    <li class="my-0 h-full">
      <a
        href={getPath(id, filePath)}
        class="group relative flex h-full flex-col justify-between gap-[var(--card-content-gap)] overflow-hidden rounded-[var(--radius-md)] border border-[color:var(--card-border)] bg-[color:var(--surface-raised)] px-[var(--card-padding-inline)] py-[var(--card-padding-block)] transition-colors duration-200 ease-out hover:border-[color:var(--card-border-strong)] focus-visible:ring-2 focus-visible:ring-[color:var(--ring-accent)] focus-visible:outline-none"
        data-card-variant={variant}
        data-astro-prefetch="viewport"
      >
        <span
          aria-hidden="true"
          class="card-marker pointer-events-none absolute left-0 w-[var(--card-marker-width)] opacity-90 transition-opacity duration-200 ease-out group-hover:opacity-100 group-focus-visible:opacity-100"
        >
          <span aria-hidden="true" class="card-marker__scoop" />
        </span>

        <div class="relative z-[1] flex flex-col gap-3 ps-[var(--card-marker-gutter)]">
          <div class="flex items-center gap-2">
            <span aria-hidden="true" class="card-icon">
              <IconNoteCard class="size-[0.9rem]" />
            </span>
            <p class="font-semibold tracking-[var(--card-meta-tracking)] text-[color:var(--muted-text)] text-[var(--card-meta-size)] uppercase">
              {formattedDate}
            </p>
          </div>
          {variant === "h2" ? (
            <h2
              {...headerProps}
              class="leading-tight font-semibold text-balance text-[color:var(--body-text)] text-[var(--card-heading-h2)] transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
            >
              {title}
            </h2>
          ) : (
            <h3
              {...headerProps}
              class="leading-snug font-semibold text-balance text-[color:var(--body-text)] text-[var(--card-heading-h3)] transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]"
            >
              {title}
            </h3>
          )}
          {showDescription && (
            <p
              class="text-[color:var(--muted-text)] text-[var(--card-body-size)]"
              style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: var(--card-body-leading);"
            >
              {description}
            </p>
          )}
        </div>

        <span class="mt-auto inline-flex items-center gap-1 ps-[var(--card-marker-gutter)] font-semibold tracking-[var(--card-footer-tracking)] text-[color:var(--nav-text)] text-[var(--card-footer-size)] uppercase transition-colors duration-150 group-hover:text-[color:var(--nav-text-strong)] group-focus-visible:text-[color:var(--nav-text-strong)]">
          Read
          <IconArrowRight class="size-[0.95rem] transition-transform duration-200 ease-out group-hover:translate-x-[0.25rem] group-focus-visible:translate-x-[0.25rem] rtl:rotate-180" />
        </span>
      </a>
    </li>
  )
}
