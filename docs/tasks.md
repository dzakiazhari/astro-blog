# Maintenance Tasks

This log tracks review-identified tasks for AI agents and human contributors. Entries are grouped by status and include the
relevant source files for quick follow-up.

## Completed

| Category | Issue | Resolution | References |
| --- | --- | --- | --- |
| Bug Fix | Structured data emitted a literal `"undefined"` publish timestamp when page dates were omitted. | Guarded the Schema.org payload so publish/modified dates only render when provided and normalised the remaining fields. | `src/layouts/Layout.astro` |
| Theming | Astro blog palette did not match Private Quartz (light/dark). | Ported Private Quartz palette from the notes site and wired the tokens into existing CSS vars so UI, code blocks, and meta theme-color inherit correctly. | `src/styles/global.css`, `public/toggle-theme.js` |
| UX | Base theme tokens still drifted from the Quartz palette, so light/dark canvases and highlights looked off. | Matched Quartz's light and dark color scales, exposed the palette tokens to Tailwind, and aligned mark highlights with the sister project's translucent tint. | `src/styles/global.css`, `src/styles/typography.css` |
| UX | Quartz palette parity and CMS hints were missing from the site. | Adopted Quartz-inspired light/dark colors, refreshed heading accents, and expanded Pages CMS with folder-aware paths, presets for tags, and media buckets. | `.pages.yml`, `src/styles/global.css`, `src/styles/typography.css` |
| Performance | Remote OG font loader issued separate CSS requests per weight, fetched large TTF binaries, and lacked regression coverage. | Consolidated the Google Fonts request, preferenced WOFF sources, memoised CSS/binary downloads, normalised the glyph query with retry/offline fallbacks, and added remote-only tests to lock the workflow using `@fontsource` bundles when offline. | `docs/performance-plan.md`, `src/utils/loadGoogleFont.ts`, `src/utils/loadGoogleFont.test.ts` |
| Performance | Post pages carried inline helpers, comments eagerly hydrated React + Giscus, and scroll scripts re-applied unchanged state. | Externalised the post enhancements, lazy-loaded comments, and cached scroll/toggle updates to eliminate redundant DOM work while preserving UX. | `docs/performance-plan.md`, `src/components/Comments.astro`, `public/scripts/comments.js`, `public/scripts/post-enhancements.js`, `public/scripts/scroll-manager.js`, `public/scripts/back-to-top.js`, `public/scripts/reading-progress.js`, `public/toggle-theme.js` |
| Documentation | README still used AstroPaper-focused messaging and assets. | Replaced the README with site-specific guidance for Unfold while preserving credit to AstroPaper. | `README.md` |
| Process | Remote font and performance passes kept re-running builds after Google Fonts 400s and format errors surfaced late in CI. | Documented the lessons in `docs/workflow-retrospective.md` and updated `AGENTS.md` with always-run build, test, and Prettier guidance so future work avoids the regressions. | `AGENTS.md`, `docs/workflow-retrospective.md` |
| Bug Fix | Reading progress, back-to-top, and Giscus comments failed to appear after navigating from the homepage. | Layout preloads the enhancement scripts and the comments island remounts per route, so helpers initialize on first visit. | `src/layouts/Layout.astro`, `src/layouts/PostDetails.astro`, `src/components/BackToTopButton.astro`, `src/components/Comments.tsx` |
| Bug Fix | Pages CMS rewrote the 2023 “Radius of My Reach” front matter with a mismatched year folder and extra toggles. | Restored the original publish metadata and removed the CMS-only `year`, `hideEditPost`, and `timezone` fields so the entry aligns with the Astro schema. | `src/data/blog/2023/radius-of-my-reach.md` |
| Bug Fix | Pages CMS saved JST timestamps with a `Z` suffix, so featured posts stayed hidden on the homepage and posts index. | Normalised blog dates to the declared timezone during content loading and added coverage to keep post filtering aligned with CMS output. | `src/content.config.ts`, `src/utils/normalizePostDate.ts`, `src/utils/postFilter.test.ts`, `src/utils/normalizePostDate.test.ts` |
| Bug Fix | Posts with Pages CMS timezone metadata still dropped from featured lists when timestamps lacked offsets or used compact values. | Defaulted entries to the site timezone, hardened date normalisation for bare and numeric offsets, and extended sorting/filter tests to lock the behaviour. | `src/content.config.ts`, `src/utils/normalizePostDate.ts`, `src/utils/normalizePostDate.test.ts`, `src/utils/getSortedPosts.test.ts`, `tsconfig.test.json` |
| Bug Fix | Scroll manager emitted `null` progress snapshots on first navigation, breaking the back-to-top button and progress bar. | Subscriptions now fall back to the cached snapshot and guard against empty detail payloads, so SPA transitions keep helpers running. | `public/scripts/scroll-manager.js`, `public/scripts/back-to-top.js`, `public/scripts/reading-progress.js` |
| Bug Fix | `getPath` returned a leading slash when `includeBase` was false, producing incorrect dynamic route params. | Path builder now assembles slug segments without the `/posts` base and keeps nested directories slugified. | `src/utils/getPath.ts`, `src/utils/getPath.test.ts` |
| Typo Fix | Search page comment misspelled "inn" and misdescribed the warning. | Comment copy now reads "Display warning in dev mode." | `src/pages/search.astro` |
| Typo Fix | Back button script comment said "Search Praam" and downplayed the stored link behavior. | Clarified comment to describe synchronizing the stored back-link. | `src/components/BackButton.astro` |
| Bug Fix | `Main.astro` saved `data-backUrl` but read `dataset.backurl`, storing `"undefined"`. | Dataset access now uses the camelCase `backUrl` key. | `src/layouts/Main.astro` |
| Bug Fix | Social share URLs were concatenated without encoding, breaking links with query params or spaces. | URLs are serialized and encoded before being appended to provider templates. | `src/components/ShareLinks.astro` |
| Documentation | README referenced FuseJS even though Pagefind powers search. | README tech stack entry updated to mention Pagefind. | `README.md` |
| Test | `postFilter` lacked coverage for draft, scheduled, and dev-mode cases. | Node test runner validates draft, schedule margin, and dev overrides. | `src/utils/postFilter.ts`, `src/utils/postFilter.test.ts` |
| UI Polish | Shiki code blocks still carried theme-supplied panel colors and per-token backdrops, producing a noisy glow. | Syntax tokens inherit neutral surfaces defined in `typography.css`, keeping diff markers while rendering on the custom card background. | `src/styles/typography.css` |
| UI Polish | Copy affordance sometimes failed to render after lazy loads, appeared as plain text, and sat outside the curved card edge. | Copy control is a styled `<button>` reattached after Astro navigations, with the pill anchored inside the rounded margin via logical offsets. | `src/layouts/PostDetails.astro`, `src/styles/typography.css` |
| UI Polish | Deployed fences still felt ad-hoc: copy pill overlapped long lines and the neutral surface read as flat highlighter residue. | Shared spacing variables add breathing room on the inline end, lighten diff/line emphasis, and align the pill with the first code line while keeping tokens vivid. | `src/styles/typography.css` |
| DX | Dev server defaulted to localhost, so remote preview tools could not connect. | The dev script now binds to `0.0.0.0:4321` and documentation/agent notes highlight the accessible host. | `package.json`, `AGENTS.md`, `README.md` |
| Process | CMS configuration could drift from blog path helpers after routing changes. | Agent guide now flags `.pages.yml` for review when blog structure shifts, and the CMS config references `BLOG_PATH` usage. | `AGENTS.md`, `.pages.yml` |
| Bug Fix | Pages CMS saved a post without `description`, breaking the Astro content schema. | Restored the frontmatter description and marked the CMS field as required so future entries stay schema-safe. | `.pages.yml`, `src/data/blog/2025/pages-cms-for-my-astro-blog-and-quartz.md` |

## Backlog

_No open tasks are currently tracked._
