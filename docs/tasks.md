# Maintenance Tasks

This log tracks review-identified tasks for AI agents and human contributors. Entries are grouped by status and include the
relevant source files for quick follow-up.

## Completed

| Category | Issue | Resolution | References |
| --- | --- | --- | --- |
| UI Polish | Markdown section headers kept a heavy drop shadow and the code copy pill stayed visible at rest, clashing with the flattened cards pass. | Removed the h2 drop shadow, aligned the copy pill with Expressive Code’s hover/focus reveal, and preserved tap access on touch devices via pointer-aware media queries. | `src/styles/typography.css` |
| UI Polish | Markdown headings overshadowed the page title and supporting elements (tables, quotes, inline callouts) drifted from the refreshed palette. | Introduced prose-specific tokens and rescaled the Markdown hierarchy so headings, tables, blockquotes, and inline semantics share the new surface, border, and accent treatments. | `src/styles/global.css`, `src/styles/typography.css` |
| UI Polish | Card drop shadows clashed with the flatter Quartz-inspired aesthetic once borders were strengthened. | Removed the card shadow tokens and hover treatment so card separation now relies on the refreshed border contrast in both themes. | `src/components/Card.astro`, `src/styles/global.css` |
| UI Polish | Notes garden links still used generic arrow glyphs, diluting the garden motif in navigation. | Added a sprout icon asset and wired it into the header and homepage hero so the notes entry carries bespoke iconography. | `src/assets/icons/IconGarden.svg`, `src/components/Header.astro`, `src/pages/index.astro` |
| UI Polish | Garden CTA still leaned on the sprout icon and block arrows after the latest design review. | Swapped in a multi-petal flower mark, simplified the CTA arrows to chevrons, and dropped the redundant hero "Latest posts" icon. | `src/assets/icons/IconGarden.svg`, `src/assets/icons/IconArrowRight.svg`, `src/assets/icons/IconArrowLeft.svg`, `src/pages/index.astro` |
| Bug Fix | Post detail page could surface the wrong "Next Post" link when the current entry was missing from the supplied posts list. | Guarded the adjacent post lookup against out-of-range indexes so navigation buttons only render when valid neighbours exist. | `src/layouts/PostDetails.astro` |
| Bug Fix | `LinkButton` only added the noopener rel when `target` was exactly `"_blank"`, so padded or upper-case values skipped the security guard. | Normalised the target value and cleaned rel tokens before merging the mandatory security relationships, keeping every `_blank` variant isolated from `window.opener`. | `src/components/LinkButton.astro` |
| Bug Fix | `LinkButton` stopped appending `noopener noreferrer` whenever callers supplied their own `rel` while still opening a new tab, so future external buttons could reintroduce the `window.opener` leak. | Merge caller-provided relations with the security tokens so `_blank` targets always include `noopener noreferrer`. | `src/components/LinkButton.astro` |
| Bug Fix | External social and share links navigated away from the site and the RSS badge opened a new tab without `rel="noopener"`, leaving the opener vulnerable. | Link buttons can now opt into `_blank` targets with an automatic noopener rel, and social/share buttons pass the target so they open safely in a new tab while the RSS badge adds the missing rel. | `src/components/LinkButton.astro`, `src/components/Socials.astro`, `src/components/ShareLinks.astro`, `src/pages/index.astro` |
| Bug Fix | Homepage social links bunched together because the wrapper lost its flex display when the `centered` prop was false. | Always render the socials container as a flexbox and only relax its justify rules for the hero layout. | `src/components/Socials.astro` |
| Bug Fix | Mobile nav button gained duplicate listeners after SPA navigations, so the menu flickered closed immediately on click. | Guarded the hamburger toggle binding and re-attached it on page-load/view transitions only when needed. | `src/components/Header.astro` |
| Bug Fix | TypeScript treated the mobile menu button as a generic `Element`, so accessing `dataset` failed during the build. | Query the nav controls with concrete element types so the dataset guard stays type-safe and the build passes. | `src/components/Header.astro` |
| UX | Header did not surface a shortcut to the external notes site. | Added a Notes navigation item that opens the configured notes URL in a new tab. | `src/components/Header.astro`, `src/config.ts` |
| Bug Fix | Leaving `SITE.lang` blank produced an empty `lang` attribute on the `<html>` tag. | Normalised the configured language value and default to `en` when empty so the HTML attribute stays valid. | `src/layouts/Layout.astro` |
| Bug Fix | Structured data emitted a literal `"undefined"` publish timestamp when page dates were omitted. | Guarded the Schema.org payload so publish/modified dates only render when provided and normalised the remaining fields. | `src/layouts/Layout.astro` |
| Theming | Astro blog palette did not match Private Quartz (light/dark). | Ported Private Quartz palette from the notes site and wired the tokens into existing CSS vars so UI, code blocks, and meta theme-color inherit correctly. | `src/styles/global.css`, `public/toggle-theme.js` |
| UX | Base theme tokens still drifted from the Quartz palette, so light/dark canvases and highlights looked off. | Matched Quartz's light and dark color scales, exposed the palette tokens to Tailwind, and aligned mark highlights with the sister project's translucent tint. | `src/styles/global.css`, `src/styles/typography.css` |
| UX | Quartz palette parity and CMS hints were missing from the site. | Adopted Quartz-inspired light/dark colors, refreshed heading accents, and expanded Pages CMS with folder-aware paths, presets for tags, and media buckets. | `.pages.yml`, `src/styles/global.css`, `src/styles/typography.css` |
| Performance | Remote OG font loader issued separate CSS requests per weight, fetched large TTF binaries, and lacked regression coverage. | Consolidated the Google Fonts request, preferenced WOFF sources, memoised CSS/binary downloads, normalised the glyph query with retry/offline fallbacks, and added remote-only tests to lock the workflow using `@fontsource` bundles when offline. | `docs/performance-plan.md`, `src/utils/loadGoogleFont.ts`, `src/utils/loadGoogleFont.test.ts` |
| Performance | Post pages carried inline helpers, comments eagerly hydrated React + Giscus, and scroll scripts re-applied unchanged state. | Externalised the post enhancements, lazy-loaded comments, and cached scroll/toggle updates to eliminate redundant DOM work while preserving UX. | `docs/performance-plan.md`, `src/components/Comments.astro`, `public/scripts/comments.js`, `public/scripts/post-enhancements.js`, `public/scripts/scroll-manager.js`, `public/scripts/back-to-top.js`, `public/scripts/reading-progress.js`, `public/toggle-theme.js` |
| Performance | Navigation waited until click to fetch destination HTML, so SPA transitions stuttered and felt throttled. | Initialized Astro's prefetch module, marked nav/post links for viewport coverage, and added pagination + sibling post hints so upcoming pages stream in ahead of time. | `src/layouts/Layout.astro`, `src/components/Header.astro`, `src/components/Card.astro`, `src/components/Pagination.astro`, `src/layouts/PostDetails.astro`, `src/pages/index.astro`, `src/components/LinkButton.astro` |
| Documentation | README still used AstroPaper-focused messaging and assets. | Replaced the README with site-specific guidance for Unfold while preserving credit to AstroPaper. | `README.md` |
| Process | Remote font and performance passes kept re-running builds after Google Fonts 400s and format errors surfaced late in CI. | Documented the lessons in `docs/workflow-retrospective.md` and updated `AGENTS.md` with always-run build, test, and Prettier guidance so future work avoids the regressions. | `AGENTS.md`, `docs/workflow-retrospective.md` |
| Bug Fix | Reading progress, back-to-top, and Giscus comments failed to appear after navigating from the homepage. | Layout preloads the enhancement scripts and the comments island remounts per route, so helpers initialize on first visit. | `src/layouts/Layout.astro`, `src/layouts/PostDetails.astro`, `src/components/BackToTopButton.astro`, `src/components/Comments.tsx` |
| Bug Fix | Pages CMS rewrote the 2023 “Radius of My Reach” front matter with a mismatched year folder and extra toggles. | Restored the original publish metadata and removed the CMS-only `year`, `hideEditPost`, and `timezone` fields so the entry aligns with the Astro schema. | `src/data/blog/2023/radius-of-my-reach.md` |
| Bug Fix | Pages CMS saved JST timestamps with a `Z` suffix, so featured posts stayed hidden on the homepage and posts index. | Normalised blog dates to the declared timezone during content loading and added coverage to keep post filtering aligned with CMS output. | `src/content.config.ts`, `src/utils/normalizePostDate.ts`, `src/utils/postFilter.test.ts`, `src/utils/normalizePostDate.test.ts` |
| Bug Fix | Posts with Pages CMS timezone metadata still dropped from featured lists when timestamps lacked offsets or used compact values. | Defaulted entries to the site timezone, hardened date normalisation for bare and numeric offsets, and extended sorting/filter tests to lock the behaviour. | `src/content.config.ts`, `src/utils/normalizePostDate.ts`, `src/utils/normalizePostDate.test.ts`, `src/utils/getSortedPosts.test.ts`, `tsconfig.test.json` |
| Bug Fix | Scroll manager emitted `null` progress snapshots on first navigation, breaking the back-to-top button and progress bar. | Subscriptions now fall back to the cached snapshot and guard against empty detail payloads, so SPA transitions keep helpers running. | `public/scripts/scroll-manager.js`, `public/scripts/back-to-top.js`, `public/scripts/reading-progress.js` |
| Bug Fix | `getPath` returned a leading slash when `includeBase` was false, producing incorrect dynamic route params. | Path builder now assembles slug segments without the `/posts` base and keeps nested directories slugified. | `src/utils/getPath.ts`, `src/utils/getPath.test.ts` |
| Typo Fix | Search page comment misspelled "inn" and misdescribed the warning. | Comment copy now reads "Display warning in dev mode." | `src/pages/search.astro` |
| Typo Fix | Back button script comment said "Search Praam" and downplayed the stored link behavior. | Clarified comment to describe synchronizing the stored back-link. | `src/components/BackButton.astro` |
| Bug Fix | `Main.astro` saved `data-backUrl` but read `dataset.backurl`, storing `"undefined"`. | Dataset access now uses the camelCase `backUrl` key. | `src/layouts/Main.astro` |
| Bug Fix | Social share URLs were concatenated without encoding, breaking links with query params or spaces. | URLs are serialized and encoded before being appended to provider templates. | `src/components/ShareLinks.astro` |
| Documentation | README referenced FuseJS even though Pagefind powers search. | README tech stack entry updated to mention Pagefind. | `README.md` |
| Test | `postFilter` lacked coverage for draft, scheduled, and dev-mode cases. | Node test runner validates draft, schedule margin, and dev overrides. | `src/utils/postFilter.ts`, `src/utils/postFilter.test.ts` |
| UI Polish | Shiki code blocks still carried theme-supplied panel colors and per-token backdrops, producing a noisy glow. | Syntax tokens inherit neutral surfaces defined in `typography.css`, keeping diff markers while rendering on the custom card background. | `src/styles/typography.css` |
| UI Polish | Copy affordance sometimes failed to render after lazy loads, appeared as plain text, and sat outside the curved card edge. | Copy control is a styled `<button>` reattached after Astro navigations, with the pill anchored inside the rounded margin via logical offsets. | `src/layouts/PostDetails.astro`, `src/styles/typography.css` |
| UI Polish | Deployed fences still felt ad-hoc: copy pill overlapped long lines and the neutral surface read as flat highlighter residue. | Shared spacing variables add breathing room on the inline end, lighten diff/line emphasis, and align the pill with the first code line while keeping tokens vivid. | `src/styles/typography.css` |
| UI Polish | Pills, tag chips, and CTA arrows shipped with mismatched spacing and stroke weights, leaving cards visually flat. | Shared pill tokens now drive LinkButton/Tag styling, cards gain a note badge, and filled arrows reinforce CTA affordances in both themes. | `src/styles/global.css`, `src/components/LinkButton.astro`, `src/components/Tag.astro`, `src/components/Card.astro`, `src/assets/icons/IconNoteCard.svg`, `src/assets/icons/IconArrowRight.svg`, `src/assets/icons/IconArrowLeft.svg` |
| Audit | Requested verification of severe bugs in the codebase. | Ran lint, test, build, and formatting checks; no critical issues surfaced. Documented the findings for future audits. | `docs/audits/2025-02-14-bug-audit.md` |
| DX | Dev server defaulted to localhost, so remote preview tools could not connect. | The dev script now binds to `0.0.0.0:4321` and documentation/agent notes highlight the accessible host. | `package.json`, `AGENTS.md`, `README.md` |
| Process | CMS configuration could drift from blog path helpers after routing changes. | Agent guide now flags `.pages.yml` for review when blog structure shifts, and the CMS config references `BLOG_PATH` usage. | `AGENTS.md`, `.pages.yml` |
| Bug Fix | Pages CMS saved a post without `description`, breaking the Astro content schema. | Restored the frontmatter description and marked the CMS field as required so future entries stay schema-safe. | `.pages.yml`, `src/data/blog/2025/pages-cms-for-my-astro-blog-and-quartz.md` |
| Process | Pages CMS config still allowed underscore-prefixed drafts and optional frontmatter that the schema requires. | Switched filename templating to `fields.*`, blocked `_*.md`, enforced slug/title/date requirements, capped description length, and targeted OG uploads to the blog media bucket. | `.pages.yml` |

## Backlog

_No open tasks are currently tracked._
